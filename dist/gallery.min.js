define(["require","exports","jquery","handlebars"],function(t,e,i,a){var n=function(){function t(t,e){this.$el=e,this.gallery=t,this.init()}return t.prototype.init=function(t){var e=this;t===void 0&&(t=null),this.$el.find("#close").click(function(t){t.preventDefault(),e.hide()}),this.$el.find("#next,#previous").click(function(t){var a=i(e).attr("id");t.preventDefault(),e.gallery.handleNextPrev(a)})},t.prototype.show=function(t){t===void 0&&(t=null),this.$el.addClass("state-active")},t.prototype.hide=function(t){t===void 0&&(t=null),this.$el.removeClass("state-active")},t.prototype.setContent=function(t,e,i){this.$el.find("#content").html(t),e?this.$el.find("#previous").show():this.$el.find("#previous").hide(),i?this.$el.find("#next").show():this.$el.find("#next").hide()},t.prototype.setHeading=function(t){this.$el.find("#heading").text(t)},t}();e.Modal=n;var r=function(){function t(t){this.api_url=window.location.pathname+"/gallery.json",this.items_per_page=1,this.group_template="gallery-group-template",this.item_template="gallery-item-template",this.item_template_source=i("#"+this.item_template).html(),this.compiled_item_template=a.compile(this.item_template_source),this.group_template_source=i("#"+this.group_template).html(),this.compiled_group_template=a.compile(this.group_template_source),this.$pagination=t.find("#pagination"),this.$container=t,this.category=[],this.types=[],this.modal=new n(this,t.find("#modal")),this.setupControls(),this.update()}return t.prototype.update=function(){var t=this,e={};e.category=this.category,e.types=this.types,i.getJSON(this.api_url,e,function(e){t.callback(e)})},t.prototype.setupControls=function(t){var e=this;t===void 0&&(t=null);var a=function(){var t=[];i(".filter--types a.state-active").each(function(){t.push(i(this).data("type"))}),e.types=t,t.length||i(".filter--types a").addClass("state-active")},n=function(){e.category=i(".filter--category a.state-active").data("category")||null};i(".filter--category a").click(function(t){t.preventDefault(),i(".filter--category a.state-active").removeClass("state-active"),i(this).addClass("state-active"),n(),this.update()}),n(),i(".filter--types a").click(function(t){t.preventDefault(),i(this).toggleClass("state-active"),a(),this.update()}),a()},t.prototype.callback=function(t){var e=this;i("#groups",this.$container).empty(),this.$pagination.empty();var a=function(t,e){for(var i=[];t.length>0;)i.push(t.splice(0,e));return i}(t.items,this.items_per_page);i.each(a,function(t,a){var n="";i.each(a,function(i,a){a.page=t+1;var r=e.compiled_item_template(a);n+=r});var r=e.compiled_group_template({data:n});i("#groups",e.$container).append(r)});var n=function(t){var a=i(e).data("i");t.preventDefault(),i(".state-current",i(e).closest("#pagination")).removeClass("state-current"),i(e).parent().addClass("state-current"),i(".group.state-current",e.$container).removeClass("state-current"),i(i(".group",e.$container)[a-1]).addClass("state-current")},r=this.$container.find(".group");i(r[0]).first().addClass("state-current");for(var s=1;r.length>=s;s++){var o=i("<li>"),l=i('<a href="#"><span class="visual-hide">Page </span>'+s+"</a>");1===s&&o.addClass("state-current"),l.data("i",s),l.on("click",n),o.append(l),this.$pagination.append(o)}this.handleExpand()},t.prototype.setPage=function(t){this.$pagination.find("a")[t-1].click()},t.prototype.getPageGroup=function(t){return this.$container.find(".group")[t-1]},t.prototype.getCurrentPageNumber=function(){return parseInt(this.$pagination.find(".state-current a").data("i"),10)},t.prototype.getTotalPages=function(){return this.$pagination.find(".state-current a").data("i")},t.prototype.handleExpand=function(){var t=this;this.$container.find("#modal"),i("a.expand",this.$container).click(function(e){e.preventDefault(),t.setActive(i(this).parent())})},t.prototype.findPrevItem=function(t){var e=t.prev(".gallery-item"),a=this.getCurrentPageNumber();return e.length||a>1&&(e=i(this.getPageGroup(a-1)).find(".gallery-item:last")),e},t.prototype.findNextItem=function(t){var e=t.next(".gallery-item"),a=this.getCurrentPageNumber();return e.length||this.$container.find(".group").length>a&&(e=i(this.getPageGroup(a+1)).find(".gallery-item:first")),e},t.prototype.setActive=function(t){var e,i,a=t.find(".gallery-item-full").clone(),n=this.getCurrentPageNumber();n!==t.data("page")&&this.setPage(t.data("page")),e=this.findPrevItem(t).length>0,i=this.findNextItem(t).length>0,this.$container.find(".gallery-item.state-active").removeClass("state-active"),t.addClass("state-active"),"Image"===t.data("type")?a.find(".expanded-media").append('<img src="'+t.data("image-large")+' alt="'+t.find(".expand img").attr("alt")+'">'):a.find(".expanded-media").append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+t.data("youtube-id")+'" frameborder="0" allowfullscreen="allowfullscreen"></iframe>'),this.modal.setContent(a,e,i),this.modal.setHeading(t.index()+1+" of "+this.$container.find(".gallery-item").length),this.modal.show()},t.prototype.handleNextPrev=function(t){var e=this.$container.find(".gallery-item.state-active");"next"===t?this.setActive(this.findNextItem(e)):this.setActive(this.findPrevItem(e))},t}();e.Gallery=r});